FROM registry.fedoraproject.org/fedora:latest

RUN dnf install -y @rpm-development-tools git

RUN mkdir /prepare
WORKDIR /prepare

COPY osbuild.spec .

RUN dnf -y builddep ./osbuild.spec

RUN pip install pydevd_pycharm debugpy

RUN mkdir /app
WORKDIR /app

COPY . /app

RUN cp tools/main_cli_dev.py osbuild/
RUN git apply tools/Containerfile.dev.patch

RUN make rpm.dev

RUN dnf install -y ./rpmbuild/RPMS/*.rpm

ENTRYPOINT [ "/usr/bin/osbuild" ]
